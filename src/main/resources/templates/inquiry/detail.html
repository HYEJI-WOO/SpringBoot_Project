<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<head>
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>

<th:block layout:fragment="script">

    <script th:inline="javascript">

    $(document).ready(function(){
        var loggedInUser = document.getElementById("username").value;
        var writer = document.getElementById("writer").value;

        if (loggedInUser === writer) {
            document.getElementById("modifyBtn").style.display = "inline-block";
            document.getElementById("deleteBtn").style.display = "inline-block";
        } else {
            document.getElementById("modifyBtn").style.display = "none";
            document.getElementById("deleteBtn").style.display = "none";
        };
    });

        var title;
        var content;

        function gohome(event) {
            window.location.href = "/inquiry/list";
        }

        function modify(event) {

            document.getElementById("title").disabled = false;
            document.getElementById("content").disabled = false;

            document.getElementById("listBtn").style.display = "none";
            document.getElementById("modifyBtn").style.display = "none";
            document.getElementById("deleteBtn").style.display = "none";
            document.getElementById("completeBtn").style.display = "inline-block";
            document.getElementById("cancelBtn").style.display = "inline-block";

            // 필드의 값을 전역 변수에 할당
            title = document.getElementById("title").value;
            content = document.getElementById("content").value;
        }

        function cancelAddressFields(event) {
            event.preventDefault();

            // 취소 버튼 클릭 시 필드 비활성화 및 버튼 초기화
            document.getElementById("title").disabled = true;
            document.getElementById("content").disabled = true;

            // 전역 변수의 값을 필드에 할당
            document.getElementById("title").value = title;
            document.getElementById("content").value = content;


            document.getElementById("listBtn").style.display = "inline-block";
            document.getElementById("deleteBtn").style.display = "inline-block";
            document.getElementById("modifyBtn").style.display = "inline-block";
            document.getElementById("completeBtn").style.display = "none";
            document.getElementById("cancelBtn").style.display = "none";
        }

        function deleteInquiry(event) {
          event.preventDefault();
          var inquiryId = document.getElementById("inquiryId").value;

          var csrfToken = $("meta[name='_csrf']").attr("content");
          var csrfHeader = $("meta[name='_csrf_header']").attr("content");

          // 삭제 확인 메시지 표시
          var confirmDelete = confirm("삭제하시겠습니까?");
          if (confirmDelete) {
            $.ajax({
              url: "/inquiry/delete/" + encodeURIComponent(parseInt(inquiryId)),
              type: "DELETE",
              beforeSend: function(xhr) {
                xhr.setRequestHeader(csrfHeader, csrfToken);
              },
              success: function(response) {
                alert('삭제되었습니다.');
                window.location.href = "/inquiry/list";
              },
              error: function(error) {
                console.log('실패');
              }
            });
          }
        }
    </script>

</th:block>

<div layout:fragment="content">
    <form action="/inquiry/modify" role="form" method="post" th:object="${info}">
    <div class="container">
            <div class="card">
                <h1>Q&amp;A 상세</h1>

                <input type="hidden" th:value="${username}" id="username" name="username">

                <div class="form-group">
                    <h5>문의 번호:</h5>
                    <input type="text" th:value="${inquiry.id}" id="inquiryId" name="inquiryId" class="form-control" readonly>
                </div>

                <div class="form-group">
                    <h5>문의 유형:</h5>
                    <input type="text" th:value="${inquiry.inquiryType == T(com.market.constant.InquiryType).PAYMENT ? '결제 문의' :
                           (inquiry.inquiryType == T(com.market.constant.InquiryType).SHIPPING ? '배송 문의' :
                           (inquiry.inquiryType == T(com.market.constant.InquiryType).PRODUCT ? '상품 문의' : '기타 문의'))}" class="form-control" id="inquiryType" name="inquiryType" disabled>
                </div>

                <div class="form-group">
                    <h5>작성자:</h5>
                    <input type="text" th:value="${inquiry.writer}" id="writer" name="writer" class="form-control" readonly>
                </div>

                <div class="form-group">
                    <h5>작성일:</h5>
                    <input type="text" th:value="${inquiry.regDate}" id="regDate" name="regDate" class="form-control" disabled>
                </div>

                <div class="form-group">
                    <h5>문의 제목:</h5>
                    <input type="text" th:value="${inquiry.title}" id="title" name="title" class="form-control" disabled>
                </div>

                <div class="form-group">
                    <h5>문의 내용:</h5>
                    <textarea class="form-control" th:text="${inquiry.content}" id="content" name="content" disabled></textarea>
                </div>

            </div>

            <div style="text-align: center">
                <button type="button" class="btn btn-success" style="" onclick="gohome(event)" id="listBtn">목록</button>
                <button type="button" class="btn btn-primary" style="" onclick="modify(event)" id="modifyBtn">수정</button>
                <button type="button" class="btn btn-danger" style="" onclick="deleteInquiry(event)" id="deleteBtn">삭제</button>
                <button type="submit" class="btn btn-primary" style="display: none" onclick="completeAddressFields(event)" id="completeBtn">수정완료</button>
                <button type="button" class="btn btn-primary" style="display: none" onclick="cancelAddressFields(event)" id="cancelBtn">취소</button>
            </div>

        </div>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    </form>
</div>

</html>
